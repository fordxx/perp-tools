# PerpBot Important Architecture & Decisions
# 永久架构决策总纲（不可随意推翻）

更新时间：2025-12
状态：✅ 当前唯一最高优先级设计依据

---

## 一、项目核心目标（不可变）

构建一个：

- ✅ 多交易所（DEX + CEX）永续合约量化套利系统
- ✅ 支持刷量、价差、资金费率、统计套利、闪电套利
- ✅ 支持真实下单、真实成交、真实 PnL
- ✅ 风控优先级高于盈利
- ✅ 支持后期全自动 + 当前强人工可控

最终目标不是模拟，而是：
> ✅ 可长期稳定运行的实盘系统

---

## 二、当前阶段性策略（强制执行）

### ✅ 第一阶段（当前唯一主线）：Bootstrap 实盘验证

当前阶段 **绝对只做一件事**：

> ✅ 构建一个 “OKX + Binance 双交易所对冲最小实盘系统”

禁止在此阶段引入：

- ❌ 多策略
- ❌ 多层资金调度
- ❌ S1/S2/S3
- ❌ ExecutionProfile
- ❌ Web Dashboard
- ❌ 资金费率套利
- ❌ 统计套利

---

## 三、资金结构长期规划（已冻结）

### ✅ 对外三层资金模型（最终形态）

| 对外层 | 含义 | 内部映射 |
|--------|------|----------|
| S1 | 刷量 / 高频对冲 | L1 + L2 |
| S2 | 微利套利增强 | L3 |
| S3 | 风险备用 | L4 + L5 |

✅ 当前 Bootstrap 阶段：**不启用该结构**

---

## 四、交易所角色划分（长期逻辑）

| 交易所 | 角色 |
|--------|------|
| OKX | 主对冲交易所（CEX） |
| Binance | 主对冲交易所（CEX） |
| EdgeX | DEX 真正实盘池 |
| Aster | 低费用 Maker 所 |
| GRVT | 负 Maker 返佣所 |
| Paradex | 零手续费但高滑点 |
| Extended | 低 Maker + 固定 Taker |
| Backpack | 高交易量可零费用 |

---

## 五、手续费与滑点总原则（不可违背）

- ✅ Maker：无滑点，有“吃不到单”的风险
- ✅ Taker：100% 成交，但有滑点与高费用
- ✅ 零手续费 ≠ 零成本（滑点是真实成本）

所有套利机会必须满足：

价差 - 手续费 - 滑点 - 延迟损耗 > 0

否则不允许执行。

---

## 六、风控哲学（最高级约束）

风控永远优先于：

- 盈利目标
- 刷量目标
- 策略复杂度

必须具备：

- ✅ 单次最大亏损限制
- ✅ 单边未成交超时回滚
- ✅ 最大持仓时间
- ✅ 手动 Kill Switch
- ✅ 网络异常熔断

---

## 七、分支管理铁律（非常重要）

- ✅ main：只允许“真实跑通过”的系统
- ✅ 每个功能一个 codex/* 分支
- ❌ 任何“未真实跑通”的系统禁止进入 main
- ✅ 旧系统允许冻结，不允许强行演进

---

## 八、现实阶段状态说明（真实记录）

- ✅ 当前所有大系统（多策略 / 多资金层）：
  - 均为 AI 生成
  - 均未真实实盘验证
- ✅ 当前工程可信度：Bootstrap 之前 = 0
- ✅ 当前最优先任务：先让系统在真实交易所 **安全跑一单**

---

## 九、允许未来升级的方向（已备案）

- ✅ Maker/Taker 智能选择引擎
- ✅ 资金费率 + 价差 叠加套利
- ✅ 多对刷量调度
- ✅ ExecutionProfile + DynamicBias
- ✅ 多账户协同套利
- ✅ 资金流跨交易所自动再平衡

---

## 十、最终工程信条（永久有效）

> ✅ 宁可少赚、慢赚  
> ❌ 不允许一次爆仓毁系统  
> ✅ 系统必须长期可控、可回滚、可解释  
> ✅ 不做“赌 AI 能对”的系统

---

【本文件为最高级工程决策文档，后续任何模块设计不得违背此文件逻辑】
